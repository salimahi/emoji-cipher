<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emoji Cipher™ – A New Puzzle Game by Salimah!</title>
  <meta name="description" content="Emoji Cipher™ is an original logic puzzle by Salimah Ismail. Decode the emojis to reveal the hidden phrase and balance the equations.">
  <meta name="author" content="Salimah Ismail">
  <meta name="copyright" content="© 2025 Salimah Ismail. Licensed under CC BY-NC-ND 4.0 International.">
  <meta name="license" content="https://creativecommons.org/licenses/by-nc-nd/4.0/">

  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
      margin: 2rem auto;
      max-width: 680px;
      line-height: 1.5;
      color: #222;
      background: #fdfdfd;
    }

    h1, h2 { text-align: center; }

    h1 { color: #8C6737; }
    h2 { color: #36171D; font-weight: 500; }

    .note-box {
      background: #F6EAED;
      border: 1px solid #36171D;
      border-radius: .5rem;
      padding: .75rem;
      margin-bottom: 1rem;
      font-size: .9rem;
    }

    .section-title{
      font-size:1rem;
      font-weight:600;
      margin:1.5rem 0 .5rem;
      text-transform:uppercase;
      letter-spacing:.03em;
      color:#8C6737;
    }

    /* Phrase layout */
    .phrase-wrapper {
      background:#fff;
      border:1px solid #ddd;
      border-radius:.5rem;
      padding:1rem;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      display:flex;
      flex-wrap:wrap;
      row-gap:1rem;
      column-gap:1rem;
      font-size:1.1rem;
    }

    .word-block {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
    }

    .word-top-row {
      display:flex;
      align-items:flex-start;
      gap:.6rem;
      flex-wrap:nowrap;
    }

    .char-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .char-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1.1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .char-input::placeholder { color:#999; font-weight:400; }
    .char-input:focus{
      outline:none;
      border-color:#000;
    }
    .char-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .char-emoji {
      font-size:1.4rem;
      line-height:1.2;
      margin-top:.25rem;
    }

    .word-separator {
      font-weight:600;
      font-size:1rem;
      line-height:1;
      color:#666;
      margin-left:.5rem;
    }

    /* Equations block */
    .equations-wrapper{
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:.75rem 1rem;
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      font-size:.9rem;
    }

    .equation-row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:.75rem 1rem;
      padding:.75rem 0;
      border-bottom:1px solid #eee;
    }
    .equation-row:last-child{border-bottom:none;}

    .eq-left {
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      align-items:flex-end;
    }

    .eq-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .num-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .num-input::placeholder{ color:#999; font-weight:400; }
    .num-input:focus{
      outline:none;
      border-color:#000;
    }
    .num-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .eq-op {
      font-size:1.1rem;
      font-weight:600;
      line-height:1;
      align-self:center;
    }

    .eq-target { font-weight:600; }

    .eq-result {
      font-weight:600;
      min-width:2rem;
      text-align:center;
    }
    .status-ok{color:#108a00;}
    .status-bad{color:#b00020;}

    /* Solution key styling (still unused/hidden) */
    .solution-box {
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:1rem;
      font-size:.95rem;
      line-height:1.4;
      color:#222;
      white-space:pre-line;
    }
    .solution-line-solved {
      background:#e6ffe6;
      border-left:3px solid #108a00;
      padding:.25rem .5rem;
      border-radius:.25rem;
      margin-bottom:.5rem;
      font-weight:600;
      color:#0a4f00;
      box-shadow:0 1px 2px rgb(0 0 0 / .06) inset;
    }
    .solution-hint {
      font-size:.8rem;
      color:#666;
      margin-bottom:.5rem;
    }

    .win-box{
      margin-top:1rem;
      border-radius:.75rem;
      padding:1rem;
      font-weight:600;
      text-align:center;
      font-size:1rem;
      display:none;
      background:#e6ffe6;
      border:2px solid #108a00;
      color:#0a4f00;
      box-shadow:0 4px 10px rgb(0 0 0 / .08);
    }

    /* FEEDBACK CARD */
    .feedback-card {
      margin-top:2rem;
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:1rem;
      font-size:.9rem;
    }
    .feedback-card-title {
      font-weight:600;
      color:#8C6737;
      margin-bottom:.5rem;
    }
    .feedback-label {
      display:block;
      font-size:.8rem;
      color:#444;
      margin-bottom:.25rem;
    }
    .feedback-input,
    .feedback-email {
      width:100%;
      box-sizing:border-box;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      padding:.5rem;
      font-family:inherit;
      font-size:.9rem;
      line-height:1.4;
    }
    .feedback-input { resize:vertical; }

    .feedback-button {
      margin-top:1rem;
      width:100%;
      padding:.75rem 1rem;
      font-size:1rem;
      border-radius:.5rem;
      border:1px solid #999;
      background:#F6EAED;
      color:#36171D;
      cursor:pointer;
      font-weight:600;
    }

    .feedback-status {
      font-size:.8rem;
      color:#108a00;
      margin-top:.5rem;
      display:none;
    }

    footer{
      margin-top:2rem;
      font-size:.8rem;
      text-align:center;
      color:#666;
    }
    footer a{
      color:#555;
      text-decoration:none;
    }

    /* celebration confetti canvas */
    #confettiCanvas {
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 999999;
    }

    /* full-screen win text */
    #solvedMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.8);
      font-size: 6vw;
      font-weight: 800;
      font-family: system-ui, sans-serif;

      background: linear-gradient(
        90deg,
        #ff005e 0%,
        #ff8a00 16%,
        #ffe600 32%,
        #00d12b 48%,
        #00c2ff 64%,
        #7a00ff 80%,
        #ff00c8 100%,
        #ff005e 120%
      );
      background-size: 200% auto;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;

      text-shadow: 0 0 25px rgba(0,0,0,0.6);

      opacity: 0;
      z-index: 1000000;
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
      animation: rainbowShift 2s linear infinite;
    }

    #solvedMessage.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    @keyframes rainbowShift {
      0%   { background-position: 0% 50%; }
      100% { background-position: -200% 50%; }
    }
  </style>
</head>
<body>
  <h1>Emoji Cipher™</h1>
  <h2>A New Puzzle Game by <a href="https://salimahismail.com">Salimah!</a></h2>

  <div class="note-box">
    Each emoji hides a secret <b>LETTER</b> and <b>NUMBER</b>.<br>
    Unlock one and you'll get the other.<br>
    Every letter is unique, <i>but numbers can repeat.</i><br>
    There are no penalties for guessing.<br>
    Good Luck!
  </div>

  <div style="margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
    <button id="shareBtn"
      style="flex:1; padding:.75rem 1rem; font-size:1rem; border-radius:.5rem; border:1px solid #999; background:#fff; cursor:pointer;">
      🔗 Share
    </button>

    <div id="shareStatus"
      style="flex:1; font-size:.8rem; color:#555; line-height:1.2; display:none;">
      Copied!
    </div>
  </div>

  <div style="display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-top:1rem; gap:.5rem;">
    <button id="prevBtn" style="flex:1; padding:.75rem 1rem; font-size:1rem; border-radius:.5rem; border:1px solid #999; background:#fff; cursor:pointer;">
      ◀ Previous
    </button>
    <div style="flex:2; text-align:center; line-height:1.2;">
      <div id="puzzleLabel" style="font-size:.9rem; font-weight:600; color:#555; white-space:nowrap;">
        Puzzle 1 / 10
      </div>
      <div id="progressLabel" style="font-size:.8rem; color:#777;">
        Solved 0 / 10
      </div>
    </div>
    <button id="nextBtn" style="flex:1; padding:.75rem 1rem; font-size:1rem; border-radius:.5rem; border:1px solid #999; background:#fff; cursor:pointer;">
      Next ▶
    </button>
  </div>

  <div class="section-title">Decode the Phrase</div>
  <div class="phrase-wrapper" id="phraseArea"></div>

  <div class="section-title">Crack the Math</div>
  <div class="equations-wrapper" id="equationsArea"></div>

  <!-- Hidden helpers (optional UI to bring back later)
  <div class="section-title">Solution Key (auto-fills as you solve)</div>
  <div class="solution-box" id="solutionBox">
    <div class="solution-hint">Solve any letter or number to unlock its pair:</div>
    <div id="solutionLines"></div>
  </div>

  <div class="win-box" id="winBox">
    ✅ You solved it!
  </div>
  -->

  <div class="feedback-card">
    <div class="feedback-card-title">Feedback</div>

    <label for="feedbackText" class="feedback-label">
      Tell me what you liked, what was confusing, or if you want more levels 👇
    </label>
    <textarea id="feedbackText" rows="3" class="feedback-input" placeholder="I would like more levels! Also can you make it so that..."></textarea>

    <label for="feedbackEmail" class="feedback-label" style="margin-top:.75rem;">
      Your email:
    </label>
    <input id="feedbackEmail" type="email" class="feedback-email" placeholder="name@email.com">

    <button id="sendFeedbackBtn" class="feedback-button">
      ✉ Send Feedback
    </button>

    <div id="feedbackStatus" class="feedback-status">
      Thanks! Your message is ready to send.
    </div>
  </div>

  <footer>
    Emoji Cipher™ © 2025 Salimah Ismail.<br>
    Licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0 International</a>.<br>
    <a href="https://salimahismail.com" target="_blank">https://salimahismail.com</a>
  </footer>

  <canvas id="confettiCanvas"></canvas>
  <div id="solvedMessage">YAY! YOU SOLVED IT!</div>

<script>
(function(){

  // -----------------------
  // 1. PUZZLES
  // -----------------------
  const PUZZLES = [
    {
      phrase: "COOL GAME BRO",
      phraseWords: [
        ["🦊","🪐","🪐","🐸"],
        ["🚀","🌵","🎲","🔮"],
        ["🧊","🐙","🪐"]
      ],
      mapping: {
        "🦊": { letter:"C", number:3 },
        "🪐": { letter:"O", number:8 },
        "🐸": { letter:"L", number:4 },
        "🚀": { letter:"G", number:7 },
        "🌵": { letter:"A", number:1 },
        "🎲": { letter:"M", number:6 },
        "🔮": { letter:"E", number:2 },
        "🧊": { letter:"B", number:5 },
        "🐙": { letter:"R", number:9 }
      },
      uniqueEmojis: ["🦊","🪐","🐸","🚀","🌵","🎲","🔮","🧊","🐙"],
      equations: [
        { left:["🚀","+","🪐"], target:15 },
        { left:["🪐","+","🧊"], target:13 },
        { left:["🦊","+","🌵","+","🎲"], target:10 },
        { left:["🎲","+","🔮"], target:8 },
        { left:["🐸","+","🚀"], target:11 },
        { left:["🧊","+","🐙"], target:14 },
        { left:["🐙","+","🌵"], target:10 },
        { left:["🚀","+","🦊","+","🐸"], target:14 }
      ]
    },
    {
      phrase: "IT IS NAP TIME",
      phraseWords: [
        ["🍄","🧊"],
        ["🍄","🐸"],
        ["🐙","🌵","🦊"],
        ["🧊","🍄","🎲","🔮"]
      ],
      mapping: {
        "🍄": { letter:"I", number:4 },
        "🧊": { letter:"T", number:9 },
        "🐸": { letter:"S", number:2 },
        "🐙": { letter:"N", number:5 },
        "🌵": { letter:"A", number:1 },
        "🦊": { letter:"P", number:7 },
        "🎲": { letter:"M", number:6 },
        "🔮": { letter:"E", number:3 }
      },
      uniqueEmojis: ["🍄","🧊","🐸","🐙","🌵","🦊","🎲","🔮"],
      equations: [
        { left:["🍄","+","🐙"], target:9 },
        { left:["🐸","+","🎲"], target:8 },
        { left:["🌵","+","🔮"], target:4 },
        { left:["🎲","+","🦊"], target:13 },
        { left:["🧊","+","🎲"], target:15 }
      ]
    },
    {
      phrase: "HERBAL OR VERBAL TEA",
      phraseWords: [
        ["🪐","🔮","🌊","🚀","🌵","🐙"],
        ["🎲","🌊"],
        ["🦊","🔮","🌊","🚀","🌵","🐙"],
        ["🧊","🔮","🌵"]
      ],
      mapping: {
        "🪐": { letter:"H", number:4 },
        "🔮": { letter:"E", number:2 },
        "🌊": { letter:"R", number:9 },
        "🚀": { letter:"B", number:5 },
        "🌵": { letter:"A", number:1 },
        "🐙": { letter:"L", number:7 },
        "🎲": { letter:"O", number:6 },
        "🦊": { letter:"V", number:8 },
        "🧊": { letter:"T", number:3 }
      },
      uniqueEmojis: ["🪐","🔮","🌊","🚀","🌵","🐙","🎲","🦊","🧊"],
      equations: [
        { left:["🪐","+","🔮"], target:6 },
        { left:["🦊","+","🧊"], target:11 },
        { left:["🌊","+","🚀"], target:14 },
        { left:["🌵","+","🐙"], target:8 },
        { left:["🔮","+","🌊"], target:11 },
        { left:["🚀","+","🌵"], target:6 },
        { left:["🦊","+","🔮"], target:10 },
        { left:["🪐","+","🧊"], target:7 },
        { left:["🧊","+","🔮","+","🌵"], target:6 }
      ]
    },
    {
      phrase: "ADDICTED TO RAGEAHOL",
      phraseWords: [
        ["🌵","🎲","🎲","🍄","🦊","🧊","🔮","🎲"],
        ["🧊","⭐️"],
        ["🌊","🌵","🚀","🔮","🌵","🐸","⭐️","🐙"]
      ],
      mapping: {
        "🌵": { letter:"A", number:1 },
        "🎲": { letter:"D", number:7 },
        "🍄": { letter:"I", number:4 },
        "🦊": { letter:"C", number:8 },
        "🧊": { letter:"T", number:9 },
        "🔮": { letter:"E", number:3 },
        "⭐️": { letter:"O", number:6 },
        "🌊": { letter:"R", number:5 },
        "🚀": { letter:"G", number:2 },
        "🐸": { letter:"H", number:4 },
        "🐙": { letter:"L", number:8 }
      },
      uniqueEmojis: ["🌵","🎲","🍄","🦊","🧊","🔮","⭐️","🌊","🚀","🐸","🐙"],
      equations: [
        { left:["🌵","+","🎲"], target:8 },
        { left:["⭐️","+","🐙"], target:14 },
        { left:["🎲","+","🍄"], target:11 },
        { left:["🦊","+","🧊"], target:17 },
        { left:["🌊","+","⭐️"], target:11 },
        { left:["🔮","+","🎲"], target:10 },
        { left:["🌊","+","🌵","+","🚀"], target:8 },
        { left:["🐸","+","🎲"], target:11 },
        { left:["🎲","+","🐙"], target:15 }
      ]
    },
    {
      phrase: "I BARELY EVEN KNOW HER",
      phraseWords: [
        ["🍄"],
        ["🚀","🌵","🌊","🔮","🐙","🧊"],
        ["🔮","🎲","🔮","🪐"],
        ["🦊","🪐","🐸","🦴"],
        ["🐢","🔮","🌊"]
      ],
      mapping: {
        "🍄": { letter:"I", number:4 },
        "🚀": { letter:"B", number:6 },
        "🌵": { letter:"A", number:1 },
        "🌊": { letter:"R", number:9 },
        "🔮": { letter:"E", number:2 },
        "🐙": { letter:"L", number:7 },
        "🧊": { letter:"Y", number:8 },
        "🎲": { letter:"V", number:5 },
        "🪐": { letter:"N", number:3 },
        "🦊": { letter:"K", number:4 },
        "🐸": { letter:"O", number:6 },
        "🦴": { letter:"W", number:2 },
        "🐢": { letter:"H", number:5 }
      },
      uniqueEmojis: ["🍄","🚀","🌵","🌊","🔮","🐙","🧊","🎲","🪐","🦊","🐸","🦴","🐢"],
      equations: [
        { left:["🍄","+","🔮"], target:6 },
        { left:["🪐","+","🌊"], target:12 },
        { left:["🐙","+","🎲"], target:12 },
        { left:["🔮","+","🐙","+","🧊"], target:17 },
        { left:["🦴","+","🐢"], target:7 },
        { left:["🐢","+","🌵"], target:6 },
        { left:["🍄","+","🦊"], target:8 },
        { left:["🌵","+","🐸"], target:7 },
        { left:["🚀","+","🎲"], target:11 },
        { left:["🦊","+","🪐","+","🐸","+","🦴"], target:15 },
        { left:["🐢","+","🔮"], target:7 }
      ]
    },
    {
      phrase: "SEND MORE KITTENS",
      phraseWords: [
        ["🦊","🐸","🪐","🎲"],
        ["🚀","🔮","🌵","🐸"],
        ["🧊","🍄","🦴","🦴","🐸","🪐","🦊"]
      ],
      mapping: {
        "🦊": { letter:"S", number:6 },
        "🐸": { letter:"E", number:2 },
        "🪐": { letter:"N", number:5 },
        "🎲": { letter:"D", number:4 },
        "🚀": { letter:"M", number:7 },
        "🔮": { letter:"O", number:8 },
        "🌵": { letter:"R", number:3 },
        "🧊": { letter:"K", number:9 },
        "🍄": { letter:"I", number:1 },
        "🦴": { letter:"T", number:4 }
      },
      uniqueEmojis: ["🦊","🐸","🪐","🎲","🚀","🔮","🌵","🧊","🍄","🦴"],
      equations: [
        { left:["🦊","+","🐸"], target:8 },
        { left:["🐸","+","🪐","+","🎲"], target:11 },
        { left:["🚀","+","🔮"], target:15 },
        { left:["🌵","+","🐸"], target:5 },
        { left:["🍄","+","🪐"], target:6 },
        { left:["🚀","+","🪐"], target:12 },
        { left:["🧊","+","🍄"], target:10 },
        { left:["🦴","+","🦊"], target:10 },
        { left:["🌵","+","🪐","+","🧊"], target:17 }
      ]
    },
    {
      phrase: "CAUGHT A VIBE",
      phraseWords: [
        ["🌵","🐙","🚀","🦊","🐸","🧊"],
        ["🐙"],
        ["🎲","🔮","🪐","🦴"]
      ],
      mapping: {
        "🌵": { letter:"C", number:2 },
        "🐙": { letter:"A", number:1 },
        "🚀": { letter:"U", number:6 },
        "🦊": { letter:"G", number:7 },
        "🐸": { letter:"H", number:4 },
        "🧊": { letter:"T", number:9 },
        "🎲": { letter:"V", number:8 },
        "🔮": { letter:"I", number:3 },
        "🪐": { letter:"B", number:5 },
        "🦴": { letter:"E", number:2 }
      },
      uniqueEmojis: ["🌵","🐙","🚀","🦊","🐸","🧊","🎲","🔮","🪐","🦴"],
      equations: [
        { left:["🌵","+","🐙"], target:3 },
        { left:["🚀","+","🦊"], target:13 },
        { left:["🐸","+","🧊"], target:13 },
        { left:["🦴","+","🐸"], target:6 },
        { left:["🎲","+","🚀"], target:14 },
        { left:["🌵","+","🔮"], target:5 },
        { left:["🔮","+","🧊","+","🦊"], target:19 },
        { left:["🪐","+","🦴"], target:7 },
        { left:["🐙","+","🎲"], target:9 }
      ]
    },
    {
      phrase: "A CENTER FOR ANTS",
      phraseWords: [
        ["🐙"],
        ["🧊","🌵","🦴","🔮","🌵","🎲"],
        ["🪐","🐸","🎲"],
        ["🐙","🦴","🔮","🚀"]
      ],
      mapping: {
        "🐙": { letter:"A", number:1 },
        "🧊": { letter:"C", number:6 },
        "🌵": { letter:"E", number:2 },
        "🦴": { letter:"N", number:5 },
        "🔮": { letter:"T", number:9 },
        "🎲": { letter:"R", number:4 },
        "🪐": { letter:"F", number:7 },
        "🐸": { letter:"O", number:8 },
        "🚀": { letter:"S", number:3 }
      },
      uniqueEmojis: ["🐙","🧊","🌵","🦴","🔮","🎲","🪐","🐸","🚀"],
      equations: [
        { left:["🧊","+","🌵"], target:8 },
        { left:["🪐","+","🚀"], target:10 },
        { left:["🦴","+","🔮"], target:14 },
        { left:["🌵","+","🎲"], target:6 },
        { left:["🪐","+","🐸"], target:15 },
        { left:["🎲","+","🐙"], target:5 },
        { left:["🧊","+","🔮"], target:15 }
      ]
    },
    {
      phrase: "BY DOG I MEAN SON",
      phraseWords: [
        ["🧊","🎲"],
        ["🐸","🪐","🦊"],
        ["🍄"],
        ["🚀","🌵","🪼","🔮"],
        ["🐙","🪐","🔮"]
      ],
      mapping: {
        "🧊": { letter:"B", number:4 },
        "🎲": { letter:"Y", number:7 },
        "🐸": { letter:"D", number:8 },
        "🪐": { letter:"O", number:6 },
        "🦊": { letter:"G", number:5 },
        "🍄": { letter:"I", number:3 },
        "🚀": { letter:"M", number:9 },
        "🌵": { letter:"E", number:2 },
        "🪼": { letter:"A", number:1 },
        "🔮": { letter:"N", number:4 },
        "🐙": { letter:"S", number:6 }
      },
      uniqueEmojis: ["🧊","🎲","🐸","🪐","🦊","🍄","🚀","🌵","🪼","🔮","🐙"],
      equations: [
        { left:["🧊","+","🎲"], target:11 },
        { left:["🐸","+","🪐"], target:14 },
        { left:["🦊","+","🍄"], target:8 },
        { left:["🐸","+","🍄","+","🚀"], target:20 },
        { left:["🎲","+","🔮"], target:11 },
        { left:["🚀","+","🌵"], target:11 },
        { left:["🪼","+","🔮"], target:5 },
        { left:["🐸","+","🧊"], target:12 },
        { left:["🦊","+","🪐"], target:11 },
        { left:["🐙","+","🪐","+","🔮"], target:16 }
      ]
    },
    {
      phrase: "GREAT WORK SO FAR",
      phraseWords: [
        ["🦊","🌵","🧊","🎲","🔮"],
        ["🚀","🐸","🌵","🦴"],
        ["🐙","🐸"],
        ["🍄","🎲","🌵"]
      ],
      mapping: {
        "🦊": { letter:"G", number:8 },
        "🌵": { letter:"R", number:4 },
        "🧊": { letter:"E", number:2 },
        "🎲": { letter:"A", number:1 },
        "🔮": { letter:"T", number:9 },
        "🚀": { letter:"W", number:6 },
        "🐸": { letter:"O", number:7 },
        "🦴": { letter:"K", number:5 },
        "🐙": { letter:"S", number:3 },
        "🍄": { letter:"F", number:4 }
      },
      uniqueEmojis: ["🦊","🌵","🧊","🎲","🔮","🚀","🐸","🦴","🐙","🍄"],
      equations: [
        { left:["🔮","+","🦴"], target:14 },
        { left:["🦊","+","🌵"], target:12 },
        { left:["🧊","+","🎲"], target:3 },
        { left:["🔮","+","🚀"], target:15 },
        { left:["🦊","+","🍄"], target:12 },
        { left:["🐸","+","🌵"], target:11 },
        { left:["🦴","+","🐙"], target:8 },
        { left:["🍄","+","🎲","+","🌵"], target:9 }
      ]
    }
  ];

  // -----------------------
  // 2. GLOBAL STATE
  // -----------------------
  let currentIndex = 0;
  let currentPuzzle = PUZZLES[currentIndex];

  // solvedPuzzles[i] = true/false
  let solvedPuzzles = Array(PUZZLES.length).fill(false);

  // per-puzzle emoji guess state
  let playerState = {};

  // celebration lock
  let hasCelebrated = false;

  // DOM refs
  const phraseArea    = document.getElementById("phraseArea");
  const equationsArea = document.getElementById("equationsArea");
  const solutionLines = document.getElementById("solutionLines"); // optional
  const winBox        = document.getElementById("winBox");        // optional
  const prevBtn       = document.getElementById("prevBtn");
  const nextBtn       = document.getElementById("nextBtn");
  const puzzleLabel   = document.getElementById("puzzleLabel");
  const progressLabel = document.getElementById("progressLabel");

  // -----------------------
  // 3. PERSISTENCE
  // -----------------------
  function loadProgressFromStorage(){
    try {
      const raw = localStorage.getItem("emojiCipherSolved");
      if(!raw) return;
      const arr = JSON.parse(raw);
      if(Array.isArray(arr) && arr.length === PUZZLES.length){
        solvedPuzzles = arr.map(x=>!!x);
      }
    } catch(e){
      // ignore parse errors
    }
  }

  function saveProgressToStorage(){
    try {
      localStorage.setItem("emojiCipherSolved", JSON.stringify(solvedPuzzles));
    } catch(e){
      // ignore quota/etc
    }
  }

  function updateProgressLabel(){
    const solvedCount = solvedPuzzles.filter(x=>x).length;
    if(progressLabel){
      progressLabel.textContent = `Solved ${solvedCount} / ${PUZZLES.length}`;
    }
  }

  // -----------------------
  // helpers
  // -----------------------
  function initPlayerState() {
    playerState = {};
    currentPuzzle.uniqueEmojis.forEach(em=>{
      playerState[em] = { letter:"", number:"", solved:false };
    });
    hasCelebrated = false;
  }

  // -----------------------
  // RENDER PHRASE
  // -----------------------
  function renderPhrase(){
    phraseArea.innerHTML = "";

    currentPuzzle.phraseWords.forEach((wordArr, wordIdx)=>{
      const wordBlock = document.createElement("div");
      wordBlock.className = "word-block";

      const topRow = document.createElement("div");
      topRow.className = "word-top-row";

      wordArr.forEach((em, charIdx)=>{
        const stack = document.createElement("div");
        stack.className = "char-stack";
        stack.dataset.emoji = em;
        stack.dataset.wordIndex = wordIdx;
        stack.dataset.charIndex = charIdx;

        const inp = document.createElement("input");
        inp.className = "char-input";
        inp.maxLength = 1;
        inp.placeholder = "_";
        inp.dataset.emoji = em;
        inp.dataset.kind = "letter";
        inp.addEventListener("input", handleGuessInput);

        const emDiv = document.createElement("div");
        emDiv.className = "char-emoji";
        emDiv.textContent = em;

        stack.appendChild(inp);
        stack.appendChild(emDiv);
        topRow.appendChild(stack);
      });

      wordBlock.appendChild(topRow);
      phraseArea.appendChild(wordBlock);

      if (wordIdx < currentPuzzle.phraseWords.length - 1){
        const slash = document.createElement("div");
        slash.className = "word-separator";
        slash.textContent = "/";
        phraseArea.appendChild(slash);
      }
    });
  }

  // -----------------------
  // RENDER EQUATIONS
  // -----------------------
  function renderEquations(){
    equationsArea.innerHTML = "";

    currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
      const row = document.createElement("div");
      row.className = "equation-row";

      const leftWrap = document.createElement("div");
      leftWrap.className = "eq-left";

      eqObj.left.forEach(token=>{
        if(token === "+"){
          const plus = document.createElement("div");
          plus.className = "eq-op";
          plus.textContent = "+";
          leftWrap.appendChild(plus);
        } else {
          const stack = document.createElement("div");
          stack.className = "eq-stack";
          stack.dataset.emoji = token;
          stack.dataset.eqIndex = eqIndex;

          const numInp = document.createElement("input");
          numInp.className = "num-input";
          numInp.maxLength = 1;
          numInp.placeholder = "_";
          numInp.dataset.emoji = token;
          numInp.dataset.kind = "number";
          numInp.addEventListener("input", handleGuessInput);

          const emDiv = document.createElement("div");
          emDiv.className = "char-emoji";
          emDiv.textContent = token;

          stack.appendChild(numInp);
          stack.appendChild(emDiv);
          leftWrap.appendChild(stack);
        }
      });

      const eqTarget = document.createElement("div");
      eqTarget.className = "eq-target";
      eqTarget.textContent = "= " + eqObj.target;

      const eqRes = document.createElement("div");
      eqRes.className = "eq-result status-bad";
      eqRes.dataset.eqIndex = eqIndex;
      eqRes.textContent = "❌";

      row.appendChild(leftWrap);
      row.appendChild(eqTarget);
      row.appendChild(eqRes);
      equationsArea.appendChild(row);
    });

    updateEquationsStatus();
  }

  // -----------------------
  // SOLUTION BOX (if visible)
  // -----------------------
  function renderSolutionBox(){
    if (!solutionLines) return;
    solutionLines.innerHTML = "";
    currentPuzzle.uniqueEmojis.forEach(em=>{
      const st = playerState[em];
      if(st.solved){
        const line = document.createElement("div");
        line.className = "solution-line-solved";
        line.textContent = `${em} = ${st.letter} = ${st.number}`;
        solutionLines.appendChild(line);
      }
    });
  }

  // -----------------------
  // UPDATE EQUATIONS STATUS
  // -----------------------
  function updateEquationsStatus(){
    currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
      let allKnown = true;
      let total = 0;

      eqObj.left.forEach(token=>{
        if(token === "+") return;
        if(playerState[token].solved){
          total += currentPuzzle.mapping[token].number;
        } else {
          allKnown = false;
        }
      });

      const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
      if(!resDiv) return;
      if(allKnown && total === eqObj.target){
        resDiv.textContent = "✅";
        resDiv.classList.remove("status-bad");
        resDiv.classList.add("status-ok");
      } else {
        resDiv.textContent = "❌";
        resDiv.classList.remove("status-ok");
        resDiv.classList.add("status-bad");
      }
    });
  }

  // -----------------------
  // GET CURRENT PHRASE AS SOLVED
  // -----------------------
  function getCurrentSolvedPhrase(){
    const wordsSolved = currentPuzzle.phraseWords.map(wordArr => {
      return wordArr.map(em => {
        if(playerState[em].solved){
          return currentPuzzle.mapping[em].letter;
        } else {
          return "_";
        }
      }).join("");
    });
    return wordsSolved.join(" ");
  }

  // -----------------------
  // INPUT HANDLER
  // -----------------------
  function handleGuessInput(e){
    const em   = e.target.dataset.emoji;
    const kind = e.target.dataset.kind;

    // If already solved, just sync UI
    if(playerState[em].solved){
      syncSolvedEmojiEverywhere(em);
      updateEquationsStatus();
      checkWin();
      return;
    }

    // clean input
    let val = e.target.value;

    if(kind === "letter"){
      val = val.toUpperCase().replace(/[^A-Z]/g,"").slice(0,1);
      e.target.value = val;
    } else { // number
      if(val !== ""){
        let n = parseInt(val,10);
        if(isNaN(n)) n = "";
        if(n < 0) n = 0;
        if(n > 9) n = 9;
        e.target.value = n === "" ? "" : String(n);
        val = e.target.value;
      }
    }

    // check against correct mapping
    const correctLetter = currentPuzzle.mapping[em].letter;
    const correctNumber = currentPuzzle.mapping[em].number.toString();

    if(kind === "letter" && val === correctLetter){
      playerState[em].letter = correctLetter;
      playerState[em].number = correctNumber;
      playerState[em].solved = true;
    } else if(kind === "number" && val === correctNumber){
      playerState[em].letter = correctLetter;
      playerState[em].number = correctNumber;
      playerState[em].solved = true;
    }

    // sync UI if solved
    if(playerState[em].solved){
      syncSolvedEmojiEverywhere(em);
      updateEquationsStatus();
      renderSolutionBox();
    }

    checkWin();
  }

  // -----------------------
  // SYNC SOLVED VALUES EVERYWHERE
  // -----------------------
  function syncSolvedEmojiEverywhere(em){
    const solvedLetter = playerState[em].letter;
    const solvedNumber = playerState[em].number;

    // all phrase inputs with this emoji
    phraseArea.querySelectorAll(`.char-stack[data-emoji="${em}"] .char-input`).forEach(inp=>{
      inp.value = solvedLetter;
      inp.disabled = true;
    });

    // all equation inputs with this emoji
    equationsArea.querySelectorAll(`.eq-stack[data-emoji="${em}"] .num-input`).forEach(inp=>{
      inp.value = solvedNumber;
      inp.disabled = true;
    });
  }

  // -----------------------
  // CONFETTI + "YOU SOLVED IT"
  // -----------------------
  function launchConfetti() {
    if (hasCelebrated) return;
    hasCelebrated = true;

    // show big message
    const msg = document.getElementById("solvedMessage");
    if (msg) {
      msg.classList.add("show");
      setTimeout(()=>{ msg.classList.remove("show"); }, 2500);
    }

    // canvas setup
    const canvas = document.getElementById("confettiCanvas");
    if (!canvas) return;
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const EMOJIS = [
      "🎉","🎊","✨","💥","💫","🌟","🔥","🤩","😎","🦄",
      "🦊","🐸","🪐","🎲","🚀","★","🔮","🧊","🐙","🌸",
      "🦩","🐢","🪼","🐍","🏵️","🎈","🥳","🪻","💐"
    ];

    // pre-render sprite
    function makeEmojiSprite(char, sizePx) {
      const off = document.createElement("canvas");
      const offCtx = off.getContext("2d");
      const pad = sizePx;
      off.width = sizePx + pad * 2;
      off.height = sizePx + pad * 2;
      offCtx.font = `${sizePx}px sans-serif`;
      offCtx.textAlign = "center";
      offCtx.textBaseline = "middle";
      offCtx.fillText(char, off.width / 2, off.height / 2);
      return { canvas: off, w: off.width, h: off.height };
    }

    const SPRITES = [];
    for (let i = 0; i < EMOJIS.length; i++) {
      const sizePx = 28 + Math.random() * 10;
      SPRITES.push(makeEmojiSprite(EMOJIS[i], sizePx));
    }

    const particles = [];
    const COUNT = 90;

    const originX = canvas.width * 0.5;
    const originY = canvas.height * 0.9;

    for (let i = 0; i < COUNT; i++) {
      const sprite = SPRITES[Math.floor(Math.random() * SPRITES.length)];

      const angleDeg = -150 + Math.random() * 120;
      const angleRad = angleDeg * Math.PI / 180;

      const speed = 550 + Math.random() * 450; // px/sec
      const vx = Math.cos(angleRad) * speed;
      const vy = Math.sin(angleRad) * speed;

      const spinSpeed = (Math.random() * 720 - 360); // deg/sec
      const life = 2200 + Math.random() * 400;       // ms

      const startX = originX + (Math.random() - 0.5) * 30;
      const startY = originY + (Math.random() - 0.5) * 15;

      particles.push({
        sprite,
        x: startX,
        y: startY,
        vx,
        vy,
        spin: 0,
        spinSpeed,
        scaleStart: 1.0,
        scaleEnd: 0.5,
        alpha: 1,
        age: 0,
        life,
        dead: false
      });
    }

    let running = true;
    let prevTS = performance.now();

    function frame(now){
      if (!running) return;
      const dt = now - prevTS;
      prevTS = now;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let aliveCount = 0;

      for (const p of particles) {
        if (p.dead) continue;

        p.age += dt;
        if (p.age >= p.life) {
          p.dead = true;
          continue;
        }
        aliveCount++;

        const tNorm = p.age / p.life; // 0..1

        // move
        p.x += p.vx * (dt / 1000);
        p.y += p.vy * (dt / 1000);

        // spin
        p.spin += p.spinSpeed * (dt / 1000);

        // scale
        const scale = p.scaleStart + (p.scaleEnd - p.scaleStart) * tNorm;

        // fade
        let alpha;
        if (tNorm < 0.7) {
          alpha = 1;
        } else {
          const tail = (tNorm - 0.7) / 0.3;
          alpha = 1 - tail;
          if (alpha < 0) alpha = 0;
        }
        p.alpha = alpha;

        // draw
        ctx.save();
        ctx.globalAlpha = p.alpha;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.spin * Math.PI / 180);
        ctx.scale(scale, scale);
        ctx.drawImage(
          p.sprite.canvas,
          -p.sprite.w / 2,
          -p.sprite.h / 2,
          p.sprite.w,
          p.sprite.h
        );
        ctx.restore();
      }

      if (aliveCount === 0) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        running = false;
        return;
      }

      requestAnimationFrame(frame);
    }

    requestAnimationFrame(frame);
  }

  // -----------------------
  // CHECK WIN
  // -----------------------
  function checkWin(){
    const finalPhrase = getCurrentSolvedPhrase();
    const phraseDone = (finalPhrase === currentPuzzle.phrase);

    let allEqCorrect = true;
    currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
      const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
      if(!resDiv || !resDiv.classList.contains("status-ok")){
        allEqCorrect = false;
      }
    });

    if (phraseDone && allEqCorrect) {
      // mark solved
      solvedPuzzles[currentIndex] = true;
      saveProgressToStorage();
      updateProgressLabel();

      if (winBox) { winBox.style.display = "block"; }
      if (!hasCelebrated) {
        launchConfetti();
      }
    } else {
      if (winBox) { winBox.style.display = "none"; }
    }
  }

  // -----------------------
  // RESTORE PUZZLE STATE IF ALREADY SOLVED
  // -----------------------
  function autofillIfSolved(){
    if (!solvedPuzzles[currentIndex]) return;

    // mark all emojis solved in playerState
    currentPuzzle.uniqueEmojis.forEach(em=>{
      playerState[em].solved = true;
      playerState[em].letter = currentPuzzle.mapping[em].letter;
      playerState[em].number = currentPuzzle.mapping[em].number.toString();
    });

    // sync all UI fields
    currentPuzzle.uniqueEmojis.forEach(em=>{
      syncSolvedEmojiEverywhere(em);
    });

    updateEquationsStatus();
    renderSolutionBox();
    checkWin();
  }

  // -----------------------
  // LOAD PUZZLE INDEX
  // -----------------------
  function loadPuzzle(newIndex){
    // clamp
    if(newIndex < 0) newIndex = 0;
    if(newIndex > PUZZLES.length-1) newIndex = PUZZLES.length-1;

    currentIndex = newIndex;
    currentPuzzle = PUZZLES[currentIndex];
    initPlayerState();

    // render everything fresh
    renderPhrase();
    renderEquations();
    renderSolutionBox();
    updateEquationsStatus();

    // autofill if solved in past
    autofillIfSolved();

    // labels
    if (puzzleLabel){
      puzzleLabel.textContent = `Puzzle ${currentIndex+1} / ${PUZZLES.length}`;
    }
    updateProgressLabel();
  }

  // -----------------------
  // SHARE BUTTON WIRING
  // -----------------------
  function initShare(){
    const shareBtn = document.getElementById("shareBtn");
    const shareStatus = document.getElementById("shareStatus");

    function getShareUrl() {
      const origin = window.location.origin;
      const path = window.location.pathname;
      return origin + path;
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        // fallback if clipboard API is blocked
        const temp = document.createElement("textarea");
        temp.value = text;
        document.body.appendChild(temp);
        temp.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(temp);
        return ok;
      }
    }

    async function doShare() {
      const url = getShareUrl();
      const solvedCount = solvedPuzzles.filter(x=>x).length;
      const message = `I solved ${solvedCount}/${PUZZLES.length} Emoji Cipher™ puzzles! Try it out: ${url}`;

      // native share first
      if (navigator.share) {
        try {
          await navigator.share({
            title: "Emoji Cipher™",
            text: `I solved ${solvedCount}/${PUZZLES.length} Emoji Cipher™ puzzles!🎉🥳 Try it:`,
            url: url
          });
          showCopiedUI("Link ready to share!");
          return;
        } catch (err) {
          // fall through to clipboard
        }
      }

      // fallback to clipboard
      const ok = await copyToClipboard(message);

      if (ok) {
        showCopiedUI("Copied!");
      } else {
        showCopiedUI("Copy manually ↓");
        shareStatus.textContent = url;
      }
    }

    function showCopiedUI(statusText){
      if(!shareBtn || !shareStatus) return;
      const originalBtnText = shareBtn.textContent;
      shareBtn.textContent = "Copied!";

      shareStatus.textContent = statusText || "Copied!";
      shareStatus.style.display = "block";

      setTimeout(() => {
        shareBtn.textContent = originalBtnText;
        shareStatus.style.display = "none";
      }, 2000);
    }

    if (shareBtn){
      shareBtn.addEventListener("click", doShare);
    }
  }

  // -----------------------
  // FEEDBACK BUTTON
  // -----------------------
  function initFeedback(){
    const sendFeedbackBtn = document.getElementById("sendFeedbackBtn");
    const feedbackStatus  = document.getElementById("feedbackStatus");

    if (!sendFeedbackBtn) return;
    sendFeedbackBtn.addEventListener("click", ()=>{
      const msgEl = document.getElementById("feedbackText");
      const emailEl = document.getElementById("feedbackEmail");

      const msg = msgEl?.value || "";
      const email = emailEl?.value || "";

      const cleanMsg = msg.trim();
      const cleanEmail = email.trim();

      if (!cleanMsg){
        if (feedbackStatus){
          feedbackStatus.style.display = "block";
          feedbackStatus.style.color = "#b00020";
          feedbackStatus.textContent = "Please tell me something first 🙂";
        }
        return;
      }

      const solvedCount = solvedPuzzles.filter(x => x).length;
      const totalCount = PUZZLES.length;

      const bodyLines = [
        "Emoji Cipher feedback:",
        cleanMsg,
        "",
        "Player info:",
        `Solved: ${solvedCount} / ${totalCount} puzzles`,
        cleanEmail ? `Reply to me at: ${cleanEmail}` : "(no email given)"
      ];

      const mailtoLink =
        "mailto:salimahismail@gmail.com"
        + "?subject=" + encodeURIComponent("Emoji Cipher feedback")
        + "&body=" + encodeURIComponent(bodyLines.join("\n"));

      window.location.href = mailtoLink;

      if (feedbackStatus){
        feedbackStatus.style.display = "block";
        feedbackStatus.style.color = "#108a00";
        feedbackStatus.textContent = "Your feedback draft just opened in email ✨";
      }

      if (msgEl) msgEl.value = "";
    });
  }

  // -----------------------
  // INIT / EVENT LISTENERS
  // -----------------------
  function init(){
    // load saved progress
    loadProgressFromStorage();

    // wire nav buttons
    if(prevBtn){
      prevBtn.addEventListener("click", ()=>{ loadPuzzle(currentIndex - 1); });
    }
    if(nextBtn){
      nextBtn.addEventListener("click", ()=>{ loadPuzzle(currentIndex + 1); });
    }

    initShare();
    initFeedback();

    // first puzzle
    loadPuzzle(0);
  }

  // kick it off safely inside IIFE
  init();

})(); // end IIFE
</script>

</body>
</html>
