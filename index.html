<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emoji Cipher‚Ñ¢ ‚Äì Puzzle</title>
  <meta name="description" content="Emoji Cipher‚Ñ¢ is an original logic puzzle by Salimah Ismail. Decode the emojis to reveal the hidden phrase and balance the equations.">
  <meta name="author" content="Salimah Ismail">
  <meta name="copyright" content="¬© 2025 Salimah Ismail. Licensed under CC BY-NC-ND 4.0 International.">
  <meta name="license" content="https://creativecommons.org/licenses/by-nc-nd/4.0/">
  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
      margin: 2rem auto;
      max-width: 680px;
      line-height: 1.5;
      color: #222;
      background: #fdfdfd;
    }
    h1, h2 { text-align: center; }

    .note-box {
      background: #fff8db;
      border: 1px solid #e6d78a;
      border-radius: .5rem;
      padding: .75rem;
      margin-bottom: 1rem;
      font-size: .9rem;
    }

    .section-title{
      font-size:1rem;
      font-weight:600;
      margin:1.5rem 0 .5rem;
      text-transform:uppercase;
      letter-spacing:.03em;
      color:#444;
    }

    /* Phrase layout */
    .phrase-wrapper {
      background:#fff;
      border:1px solid #ddd;
      border-radius:.5rem;
      padding:1rem;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      display:flex;
      flex-wrap:wrap;
      row-gap:1rem;
      column-gap:1rem;
      font-size:1.1rem;
    }

    .word-block {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
    }

    .word-top-row,
    .word-bottom-row {
      display:flex;
      align-items:flex-start;
      gap:.6rem;
      flex-wrap:nowrap;
    }

    .char-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .char-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1.1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .char-input::placeholder {
      color:#999;
      font-weight:400;
    }
    .char-input:focus{
      outline:none;
      border-color:#000;
    }
    .char-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .char-emoji {
      font-size:1.4rem;
      line-height:1.2;
      margin-top:.25rem;
    }

    .word-separator {
      font-weight:600;
      font-size:1rem;
      line-height:1;
      color:#666;
      margin-left:.5rem;
    }

    /* Equations block */
    .equations-wrapper{
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:.75rem 1rem;
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      font-size:.9rem;
    }

    .equation-row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:.75rem 1rem;
      padding:.75rem 0;
      border-bottom:1px solid #eee;
    }
    .equation-row:last-child{border-bottom:none;}

    .eq-left {
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      align-items:flex-end;
    }

    .eq-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .num-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .num-input::placeholder{
      color:#999;
      font-weight:400;
    }
    .num-input:focus{
      outline:none;
      border-color:#000;
    }
    .num-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .eq-op {
      font-size:1.1rem;
      font-weight:600;
      line-height:1;
      align-self:center;
    }

    .eq-target {
      font-weight:600;
    }

    .eq-result {
      font-weight:600;
      min-width:2rem;
      text-align:center;
    }
    .status-ok{color:#108a00;}
    .status-bad{color:#b00020;}

    /* Solution key */
    .solution-box {
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:1rem;
      font-size:.95rem;
      line-height:1.4;
      color:#222;
      white-space:pre-line;
    }
    .solution-line-solved {
      background:#e6ffe6;
      border-left:3px solid #108a00;
      padding:.25rem .5rem;
      border-radius:.25rem;
      margin-bottom:.5rem;
      font-weight:600;
      color:#0a4f00;
      box-shadow:0 1px 2px rgb(0 0 0 / .06) inset;
    }
    .solution-hint {
      font-size:.8rem;
      color:#666;
      margin-bottom:.5rem;
    }

    .win-box{
      margin-top:1rem;
      border-radius:.75rem;
      padding:1rem;
      font-weight:600;
      text-align:center;
      font-size:1rem;
      display:none;
      background:#e6ffe6;
      border:2px solid #108a00;
      color:#0a4f00;
      box-shadow:0 4px 10px rgb(0 0 0 / .08);
    }

    footer{
      margin-top:2rem;
      font-size:.8rem;
      text-align:center;
      color:#666;
    }
    footer a{
      color:#555;
      text-decoration:none;
    }
    /* celebration confetti */
/* celebration confetti */
#confettiLayer {
  pointer-events: none;
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: visible;
  z-index: 9999;
}

.confetti-emoji {
  position: absolute;
  font-size: 2rem;
  will-change: transform, opacity;
  animation-timing-function: ease-out;
  animation-iteration-count: 1;
  animation-fill-mode: forwards;
}
@keyframes burst-fade {
  0% {
    opacity: 1;
    transform: translate3d(var(--x-start), var(--y-start), 0) scale(1) rotate(0deg);
  }
  100% {
    opacity: 0;
    transform: translate3d(var(--x-end), var(--y-end), 0) scale(0.6) rotate(540deg);
  }
}

  </style>
</head>
<body>
  <h1>Emoji Cipher‚Ñ¢</h1>
  <h2>A New Puzzle Game by <a href="https://salimahismail.com">Salimah!</a></h2>

  <div class="note-box">
    Each emoji hides a secret <b>LETTER</b> and <b>NUMBER</b>.<br>
    Every letter is unique, <i>but numbers can repeat.</i> <br>
    Unlock one and you'll get the other. <br>
    There are ten randomly generated puzzles (for now). <br>
    Good Luck!
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin-top:1rem; gap:.5rem;">
  <button id="prevBtn" style="flex:1; padding:.75rem 1rem; font-size:1rem; border-radius:.5rem; border:1px solid #999; background:#fff; cursor:pointer;">
    ‚óÄ Previous
  </button>
  <div id="puzzleLabel" style="flex:0; font-size:.9rem; font-weight:600; color:#555; text-align:center; white-space:nowrap;">
    Puzzle 1 / 10
  </div>
  <button id="nextBtn" style="flex:1; padding:.75rem 1rem; font-size:1rem; border-radius:.5rem; border:1px solid #999; background:#fff; cursor:pointer;">
    Next ‚ñ∂
  </button>
</div>

  <div class="section-title">Decode the Phrase</div>
  <div class="phrase-wrapper" id="phraseArea"></div>

  <div class="section-title">Crack the Math</div>
  <div class="equations-wrapper" id="equationsArea"></div>

  <!--
  <div class="section-title">Solution Key (auto-fills as you solve)</div>
  <div class="solution-box" id="solutionBox">
    <div class="solution-hint">Solve any letter or number to unlock its pair:</div>
    <div id="solutionLines"></div>
  </div>

  <div class="win-box" id="winBox">
    ‚úÖ You solved it!
  </div>
  -->

  <footer>
    Emoji Cipher‚Ñ¢ ¬© 2025 Salimah Ismail.<br>
    Licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0 International</a>. <br>
    <a href="https://salimahismail.com" target="_blank">https://salimahismail.com</a> 
  </footer>

  <div id="confettiLayer"></div>

  <script>
  (function(){

    // --- ALL 10 PUZZLES ----------------------------------------------------
    // For each puzzle:
    // - phrase: final solution text (used for win condition)
    // - phraseWords: array of word-arrays (each entry is emojis for that word)
    // - mapping: emoji -> {letter, number}
    // - uniqueEmojis: list of all emojis used in that puzzle
    // - equations: array of {left:[emoji,"+",emoji,...], target:number}
    //
    // Important: every letter in the phrase must have an emoji in phraseWords
    // and that emoji must appear in mapping.
    // Also we make sure each emoji appears in (or is inferable from) equations.

    const PUZZLES = [
      // 1. COOL GAME BRO
      {
        phrase: "COOL GAME BRO",
        phraseWords: [
          ["ü¶ä","ü™ê","ü™ê","üê∏"],        // COOL
          ["üöÄ","üåµ","üé≤","üîÆ"],        // GAME
          ["üßä","üêô","ü™ê"]             // BRO (B R O)
        ],
        mapping: {
          "ü¶ä": { letter:"C", number:3 },
          "ü™ê": { letter:"O", number:8 },
          "üê∏": { letter:"L", number:4 },
          "üöÄ": { letter:"G", number:7 },
          "üåµ": { letter:"A", number:1 },
          "üé≤": { letter:"M", number:6 },
          "üîÆ": { letter:"E", number:2 },
          "üßä": { letter:"B", number:5 },
          "üêô": { letter:"R", number:9 }
        },
        uniqueEmojis: ["ü¶ä","ü™ê","üê∏","üöÄ","üåµ","üé≤","üîÆ","üßä","üêô"],
        equations: [
          { left:["ü¶ä","+","ü™ê"], target:11 },              //3+8
          { left:["ü™ê","+","üê∏"], target:12 },              //8+4
          { left:["üöÄ","+","üåµ","+","üé≤"], target:14 },     //7+1+6
          { left:["üé≤","+","üîÆ"], target:8 },              //6+2
          { left:["üßä","+","üåµ"], target:6 },              //5+1
          { left:["üêô","+","üåµ"], target:10 }              //9+1
        ]
      },

      // 2. IT IS NAP TIME
      {
        phrase: "IT IS NAP TIME",
        phraseWords: [
          ["üçÑ","üßä"],                // IT
          ["üçÑ","üê∏"],                // IS
          ["üêô","üåµ","ü¶ä"],           // NAP
          ["üßä","üçÑ","üé≤","üîÆ"]       // TIME
        ],
        // We need coverage for I,T,I,S,N,A,P,T,I,M,E
        // - üçÑ = I
        // - üßä = T
        // - üê∏ = S
        // - üêô = N
        // - üåµ = A
        // - ü¶ä = P
        // - üé≤ = M
        // - üîÆ = E
        mapping: {
          "üçÑ": { letter:"I", number:4 },
          "üßä": { letter:"T", number:9 },
          "üê∏": { letter:"S", number:2 },
          "üêô": { letter:"N", number:5 },
          "üåµ": { letter:"A", number:1 },
          "ü¶ä": { letter:"P", number:7 },
          "üé≤": { letter:"M", number:6 },
          "üîÆ": { letter:"E", number:3 }
        },
        uniqueEmojis: ["üçÑ","üßä","üê∏","üêô","üåµ","ü¶ä","üé≤","üîÆ"],
        equations: [
          { left:["üçÑ","+","üßä"], target:13 },     //4+9
          { left:["üê∏","+","üêô"], target:7 },      //2+5
          { left:["üåµ","+","ü¶ä"], target:8 },      //1+7
          { left:["üé≤","+","üîÆ"], target:9 },      //6+3
          { left:["üßä","+","üé≤"], target:15 }      //9+6
        ]
      },

      // 3. HERBAL OR VERBAL TEA
      {
        phrase: "HERBAL OR VERBAL TEA",
        phraseWords: [
          ["ü™ê","üîÆ","üåä","üöÄ","üåµ","üêô"],   // HERBAL
          ["üé≤","üåä"],                    // OR
          ["ü¶ä","üîÆ","üåä","üöÄ","üåµ","üêô"],  // VERBAL
          ["üßä","üîÆ","üåµ"]                // TEA
        ],
        // Letters needed: H E R B A L / O R / V E R B A L / T E A
        mapping: {
          "ü™ê": { letter:"H", number:4 },
          "üîÆ": { letter:"E", number:2 },
          "üåä": { letter:"R", number:9 },
          "üöÄ": { letter:"B", number:5 },
          "üåµ": { letter:"A", number:1 },
          "üêô": { letter:"L", number:7 },
          "üé≤": { letter:"O", number:6 },
          "ü¶ä": { letter:"V", number:8 },
          "üßä": { letter:"T", number:3 }
        },
        uniqueEmojis: ["ü™ê","üîÆ","üåä","üöÄ","üåµ","üêô","üé≤","ü¶ä","üßä"],
        equations: [
          { left:["ü™ê","+","üîÆ"], target:6 },              //4+2
          { left:["üåä","+","üöÄ"], target:14 },             //9+5
          { left:["üåµ","+","üêô"], target:8 },              //1+7
          { left:["üé≤","+","üåä"], target:15 },             //6+9
          { left:["ü¶ä","+","üîÆ"], target:10 },             //8+2
          { left:["üßä","+","üîÆ","+","üåµ"], target:6 }       //3+2+1
        ]
      },

      // 4. ADDICTED TO RAGEAHOL
      {
        phrase: "ADDICTED TO RAGEAHOL",
        phraseWords: [
          ["üåµ","üé≤","üé≤","üçÑ","ü¶ä","üßä","üîÆ","üé≤"], // ADDICTED
          ["üßä","üé≤"],                             // TO
          ["üåä","üåµ","üöÄ","üîÆ","üåµ","üê∏","üé≤","üêô"]  // RAGEAHOL
        ],
        // We need A D D I C T E D / T O / R A G E A H O L
        mapping: {
          "üåµ": { letter:"A", number:1 },
          "üé≤": { letter:"D", number:7 },
          "üçÑ": { letter:"I", number:4 },
          "ü¶ä": { letter:"C", number:8 },
          "üßä": { letter:"T", number:9 },
          "üîÆ": { letter:"E", number:3 },
          "üåä": { letter:"R", number:5 },
          "üöÄ": { letter:"G", number:2 },
          "üê∏": { letter:"H", number:4 },
          "üêô": { letter:"L", number:8 }
        },
        uniqueEmojis: ["üåµ","üé≤","üçÑ","ü¶ä","üßä","üîÆ","üåä","üöÄ","üê∏","üêô"],
        equations: [
          { left:["üåµ","+","üé≤"], target:8 },              //1+7
          { left:["üé≤","+","üçÑ"], target:11 },             //7+4
          { left:["ü¶ä","+","üßä"], target:17 },             //8+9
          { left:["üîÆ","+","üé≤"], target:10 },             //3+7
          { left:["üåä","+","üåµ","+","üöÄ"], target:8 },      //5+1+2
          { left:["üê∏","+","üé≤"], target:11 },             //4+7
          { left:["üé≤","+","üêô"], target:15 }              //7+8
        ]
      },

      // 5. I BARELY EVEN KNOW HER  (FIXED)
{
  phrase: "I BARELY EVEN KNOW HER",
  phraseWords: [
    ["üçÑ"],                                         // I
    ["üöÄ","üåµ","üåä","üîÆ","üêô","üßä"],                 // BARELY
    ["üîÆ","üé≤","üîÆ","ü™ê"],                           // EVEN
    ["ü¶ä","ü™ê","üê∏","ü¶¥"],                           // KNOW
    ["üê¢","üîÆ","üåä"]                                // HER
  ],
  mapping: {
    "üçÑ": { letter:"I", number:4 },
    "üöÄ": { letter:"B", number:6 },
    "üåµ": { letter:"A", number:1 },
    "üåä": { letter:"R", number:9 },
    "üîÆ": { letter:"E", number:2 },
    "üêô": { letter:"L", number:7 },
    "üßä": { letter:"Y", number:8 },
    "üé≤": { letter:"V", number:5 },
    "ü™ê": { letter:"N", number:3 },
    "ü¶ä": { letter:"K", number:4 },
    "üê∏": { letter:"O", number:6 },
    "ü¶¥": { letter:"W", number:2 },
    "üê¢": { letter:"H", number:5 }
  },
  uniqueEmojis: ["üçÑ","üöÄ","üåµ","üåä","üîÆ","üêô","üßä","üé≤","ü™ê","ü¶ä","üê∏","ü¶¥","üê¢"],
  equations: [
    { left:["üçÑ","+","üöÄ"], target:10 },                 // 4+6
    { left:["üåµ","+","üåä"], target:10 },                 // 1+9
    { left:["üîÆ","+","üêô","+","üßä"], target:17 },        // 2+7+8
    { left:["üîÆ","+","üé≤"], target:7 },                  // 2+5
    { left:["ü¶ä","+","ü™ê","+","üê∏","+","ü¶¥"], target:15 },// 4+3+6+2
    { left:["üê¢","+","üîÆ"], target:7 }                   // 5+2
  ]
},


      // 6. SEND MORE KITTENS
      {
        phrase: "SEND MORE KITTENS",
        phraseWords: [
          ["ü¶ä","üê∏","ü™ê","üé≤"],               // SEND
          ["üöÄ","üîÆ","üåµ","üê∏"],               // MORE
          ["üßä","üçÑ","ü¶¥","ü¶¥","üê∏","ü™º","üêç"] // KITTENS
        ],
        // We need S E N D / M O R E / K I T T E N S
        // Map each:
        // ü¶ä S
        // üê∏ E
        // ü™ê N
        // üé≤ D
        // üöÄ M
        // üîÆ O
        // üåµ R
        // üßä K
        // üçÑ I
        // ü¶¥ T
        // ü™º N (again N, reuse 5)
        // üêç S (again S, reuse 6)
        mapping: {
          "ü¶ä": { letter:"S", number:6 },
          "üê∏": { letter:"E", number:2 },
          "ü™ê": { letter:"N", number:5 },
          "üé≤": { letter:"D", number:4 },
          "üöÄ": { letter:"M", number:7 },
          "üîÆ": { letter:"O", number:8 },
          "üåµ": { letter:"R", number:3 },
          "üßä": { letter:"K", number:9 },
          "üçÑ": { letter:"I", number:1 },
          "ü¶¥": { letter:"T", number:4 },
          "ü™º": { letter:"N", number:5 },
          "üêç": { letter:"S", number:6 }
        },
        uniqueEmojis: ["ü¶ä","üê∏","ü™ê","üé≤","üöÄ","üîÆ","üåµ","üßä","üçÑ","ü¶¥","ü™º","üêç"],
        equations: [
          { left:["ü¶ä","+","üê∏"], target:8 },                //6+2
          { left:["üê∏","+","ü™ê","+","üé≤"], target:11 },      //2+5+4
          { left:["üöÄ","+","üîÆ"], target:15 },              //7+8
          { left:["üåµ","+","üê∏"], target:5 },               //3+2
          { left:["üßä","+","üçÑ"], target:10 },              //9+1
          { left:["ü¶¥","+","ü¶¥"], target:8 },               //4+4
          { left:["üê∏","+","ü™º","+","üêç"], target:13 }       //2+5+6
        ]
      },

      // 7. CAUGHT A VIBE
      {
        phrase: "CAUGHT A VIBE",
        phraseWords: [
          ["üåµ","üêô","üöÄ","ü¶ä","üê∏","üßä"], // CAUGHT
          ["üêô"],                        // A
          ["üé≤","üîÆ","ü™ê","ü¶¥"]          // VIBE
        ],
        // We need C A U G H T / A / V I B E
        mapping: {
          "üåµ": { letter:"C", number:2 },
          "üêô": { letter:"A", number:1 },
          "üöÄ": { letter:"U", number:6 },
          "ü¶ä": { letter:"G", number:7 },
          "üê∏": { letter:"H", number:4 },
          "üßä": { letter:"T", number:9 },
          "üé≤": { letter:"V", number:8 },
          "üîÆ": { letter:"I", number:3 },
          "ü™ê": { letter:"B", number:5 },
          "ü¶¥": { letter:"E", number:2 }
        },
        uniqueEmojis: ["üåµ","üêô","üöÄ","ü¶ä","üê∏","üßä","üé≤","üîÆ","ü™ê","ü¶¥"],
        equations: [
          { left:["üåµ","+","üêô"], target:3 },       //2+1
          { left:["üöÄ","+","ü¶ä"], target:13 },      //6+7
          { left:["üê∏","+","üßä"], target:13 },      //4+9
          { left:["üé≤","+","üîÆ"], target:11 },      //8+3
          { left:["ü™ê","+","ü¶¥"], target:7 },       //5+2
          { left:["üêô","+","üé≤"], target:9 }        //1+8
        ]
      },

      // 8. A CENTER FOR ANTS
      {
        phrase: "A CENTER FOR ANTS",
        phraseWords: [
          ["üêô"],                                  // A
          ["üßä","üåµ","ü¶¥","üîÆ","üåµ","üé≤"],          // CENTER
          ["ü™ê","üê∏","üé≤"],                         // FOR
          ["üêô","ü¶¥","üîÆ","üöÄ"]                     // ANTS
        ],
        // We need A / C E N T E R / F O R / A N T S
        mapping: {
          "üêô": { letter:"A", number:1 },
          "üßä": { letter:"C", number:6 },
          "üåµ": { letter:"E", number:2 },
          "ü¶¥": { letter:"N", number:5 },
          "üîÆ": { letter:"T", number:9 },
          "üé≤": { letter:"R", number:4 },
          "ü™ê": { letter:"F", number:7 },
          "üê∏": { letter:"O", number:8 },
          "üöÄ": { letter:"S", number:3 }
        },
        uniqueEmojis: ["üêô","üßä","üåµ","ü¶¥","üîÆ","üé≤","ü™ê","üê∏","üöÄ"],
        equations: [
          { left:["üßä","+","üåµ"], target:8 },                     //6+2
          { left:["ü¶¥","+","üîÆ"], target:14 },                   //5+9
          { left:["üåµ","+","üé≤"], target:6 },                    //2+4
          { left:["ü™ê","+","üê∏"], target:15 },                   //7+8
          { left:["üé≤","+","üêô"], target:5 },                    //4+1
          { left:["üêô","+","ü¶¥","+","üîÆ","+","üöÄ"], target:18 }   //1+5+9+3
        ]
      },

      // 9. BY DOG I MEAN SON
      {
        phrase: "BY DOG I MEAN SON",
        phraseWords: [
          ["üßä","üé≤"],               // BY
          ["üê∏","ü™ê","ü¶ä"],          // DOG
          ["üçÑ"],                    // I
          ["üöÄ","üåµ","ü™º","üîÆ"],     // MEAN
          ["üêô","ü™ê","üîÆ"]           // SON
        ],
        // We need B Y / D O G / I / M E A N / S O N
        mapping: {
          "üßä": { letter:"B", number:4 },
          "üé≤": { letter:"Y", number:7 },
          "üê∏": { letter:"D", number:8 },
          "ü™ê": { letter:"O", number:6 },
          "ü¶ä": { letter:"G", number:5 },
          "üçÑ": { letter:"I", number:3 },
          "üöÄ": { letter:"M", number:9 },
          "üåµ": { letter:"E", number:2 },
          "ü™º": { letter:"A", number:1 },
          "üîÆ": { letter:"N", number:4 },
          "üêô": { letter:"S", number:6 }
        },
        uniqueEmojis: ["üßä","üé≤","üê∏","ü™ê","ü¶ä","üçÑ","üöÄ","üåµ","ü™º","üîÆ","üêô"],
        equations: [
          { left:["üßä","+","üé≤"], target:11 },           //4+7
          { left:["üê∏","+","ü™ê"], target:14 },           //8+6
          { left:["ü¶ä","+","üçÑ"], target:8 },            //5+3
          { left:["üöÄ","+","üåµ"], target:11 },           //9+2
          { left:["ü™º","+","üîÆ"], target:5 },            //1+4
          { left:["üêô","+","ü™ê","+","üîÆ"], target:16 }    //6+6+4
        ]
      },

      // 10. GREAT WORK SO FAR
      {
        phrase: "GREAT WORK SO FAR",
        phraseWords: [
          ["ü¶ä","üåµ","üßä","üé≤","üîÆ"],  // GREAT
          ["üöÄ","üê∏","üåµ","ü¶¥"],       // WORK
          ["üêô","üê∏"],                // SO
          ["üçÑ","üé≤","üåµ"]            // FAR
        ],
        // We need G R E A T / W O R K / S O / F A R
        mapping: {
          "ü¶ä": { letter:"G", number:8 },
          "üåµ": { letter:"R", number:4 },
          "üßä": { letter:"E", number:2 },
          "üé≤": { letter:"A", number:1 },
          "üîÆ": { letter:"T", number:9 },
          "üöÄ": { letter:"W", number:6 },
          "üê∏": { letter:"O", number:7 },
          "ü¶¥": { letter:"K", number:5 },
          "üêô": { letter:"S", number:3 },
          "üçÑ": { letter:"F", number:4 }
        },
        uniqueEmojis: ["ü¶ä","üåµ","üßä","üé≤","üîÆ","üöÄ","üê∏","ü¶¥","üêô","üçÑ"],
        equations: [
          { left:["ü¶ä","+","üåµ"], target:12 },         //8+4
          { left:["üßä","+","üé≤"], target:3 },          //2+1
          { left:["üîÆ","+","üöÄ"], target:15 },         //9+6
          { left:["üê∏","+","üåµ"], target:11 },         //7+4
          { left:["ü¶¥","+","üêô"], target:8 },          //5+3
          { left:["üçÑ","+","üé≤","+","üåµ"], target:9 }   //4+1+4
        ]
      }
    ];

    // Put Puzzles in Order
    let currentIndex = 0; // start at puzzle 0
    let currentPuzzle = PUZZLES[currentIndex];


    // Track solve state for each emoji
    // { "ü¶ä": {letter:"", number:"", solved:false}, ... }
    const playerState = {};
    currentPuzzle.uniqueEmojis.forEach(em=>{
      playerState[em] = { letter:"", number:"", solved:false };
    });

    let hasCelebrated = false;

    // DOM refs
    const phraseArea    = document.getElementById("phraseArea");
    const equationsArea = document.getElementById("equationsArea");
    const solutionLines = document.getElementById("solutionLines"); //may be null now
    const winBox        = document.getElementById("winBox"); //may be null now
    const prevBtn      = document.getElementById("prevBtn");
    const nextBtn      = document.getElementById("nextBtn");
    const puzzleLabel  = document.getElementById("puzzleLabel");

    // Render PHRASE
    // Each word:
    // - top row: inputs per emoji
    // - bottom row: emojis per emoji
    // After each word (except last), insert a "/" separator visually in the wrapper.
    function renderPhrase(){
      phraseArea.innerHTML = "";

      currentPuzzle.phraseWords.forEach((wordArr, wordIdx)=>{
        const wordBlock = document.createElement("div");
        wordBlock.className = "word-block";

        const topRow = document.createElement("div");
        topRow.className = "word-top-row";

        wordArr.forEach((em, charIdx)=>{
          const stack = document.createElement("div");
          stack.className = "char-stack";
          stack.dataset.emoji = em;
          stack.dataset.wordIndex = wordIdx;
          stack.dataset.charIndex = charIdx;

          const inp = document.createElement("input");
          inp.className = "char-input";
          inp.maxLength = 1;
          inp.placeholder = "_";
          inp.dataset.emoji = em;
          inp.dataset.kind = "letter";
          inp.addEventListener("input", handleGuessInput);

          const emDiv = document.createElement("div");
          emDiv.className = "char-emoji";
          emDiv.textContent = em;

          stack.appendChild(inp);
          stack.appendChild(emDiv);
          topRow.appendChild(stack);
        });

        // emoji row under it (visual reference)
        wordArr.forEach(em=>{
          const emSpan = document.createElement("div");
          emSpan.className = "char-emoji";
          emSpan.textContent = em;
        });

        wordBlock.appendChild(topRow);
        phraseArea.appendChild(wordBlock);

        if (wordIdx < currentPuzzle.phraseWords.length - 1){
          const slash = document.createElement("div");
          slash.className = "word-separator";
          slash.textContent = "/";
          phraseArea.appendChild(slash);
        }
      });
    }

    // Render EQUATIONS
    // Each equation is:
    // [ num-input / emoji ] + [ num-input / emoji ] ... = target ‚úÖ/‚ùå
    function renderEquations(){
      equationsArea.innerHTML = "";

      currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
        const row = document.createElement("div");
        row.className = "equation-row";

        const leftWrap = document.createElement("div");
        leftWrap.className = "eq-left";

        eqObj.left.forEach(token=>{
          if(token === "+"){
            const plus = document.createElement("div");
            plus.className = "eq-op";
            plus.textContent = "+";
            leftWrap.appendChild(plus);
          } else {
            const stack = document.createElement("div");
            stack.className = "eq-stack";
            stack.dataset.emoji = token;
            stack.dataset.eqIndex = eqIndex;

            const numInp = document.createElement("input");
            numInp.className = "num-input";
            numInp.maxLength = 1;
            numInp.placeholder = "_";
            numInp.dataset.emoji = token;
            numInp.dataset.kind = "number";
            numInp.addEventListener("input", handleGuessInput);

            const emDiv = document.createElement("div");
            emDiv.className = "char-emoji";
            emDiv.textContent = token;

            stack.appendChild(numInp);
            stack.appendChild(emDiv);
            leftWrap.appendChild(stack);
          }
        });

        const eqTarget = document.createElement("div");
        eqTarget.className = "eq-target";
        eqTarget.textContent = "= " + eqObj.target;

        const eqRes = document.createElement("div");
        eqRes.className = "eq-result status-bad";
        eqRes.dataset.eqIndex = eqIndex;
        eqRes.textContent = "‚ùå";

        row.appendChild(leftWrap);
        row.appendChild(eqTarget);
        row.appendChild(eqRes);
        equationsArea.appendChild(row);
      });

      updateEquationsStatus();
    }

    // Render SOLUTION KEY
    // For each solved emoji, show "ü¶ä = C = 3"
    function renderSolutionBox(){
      if (!solutionLines) return; // box hidden
  solutionLines.innerHTML = "";
      currentPuzzle.uniqueEmojis.forEach(em=>{
        const st = playerState[em];
        if(st.solved){
          const line = document.createElement("div");
          line.className = "solution-line-solved";
          line.textContent = `${em} = ${st.letter} = ${st.number}`;
          solutionLines.appendChild(line);
        }
      });
    }

    // Handle guesses from any input:
    // - phrase letter boxes (kind="letter")
    // - equation number boxes (kind="number")
    function handleGuessInput(e){
      const em   = e.target.dataset.emoji;
      const kind = e.target.dataset.kind;

      // if it's already solved, just sync it back and ignore edits
      if(playerState[em].solved){
        syncSolvedEmojiEverywhere(em);
        updateEquationsStatus();
        checkWin();
        return;
      }

      let val = e.target.value;

      if(kind === "letter"){
        val = val.toUpperCase().replace(/[^A-Z]/g,"").slice(0,1);
        e.target.value = val;
      } else {
        // kind === "number"
        if(val !== ""){
          let n = parseInt(val,10);
          if(isNaN(n)) n = "";
          if(n < 0) n = 0;
          if(n > 9) n = 9;
          e.target.value = n === "" ? "" : String(n);
          val = e.target.value;
        }
      }

      const correctLetter = currentPuzzle.mapping[em].letter;
      const correctNumber = String(currentPuzzle.mapping[em].number);

      const solvedByLetter = (kind==="letter" && val === correctLetter);
      const solvedByNumber = (kind==="number" && val === correctNumber);

      if(solvedByLetter || solvedByNumber){
        // Mark global solved
        playerState[em].solved  = true;
        playerState[em].letter  = correctLetter;
        playerState[em].number  = correctNumber;

        syncSolvedEmojiEverywhere(em);
      } else {
        // Not solved yet, store partial guess
        if(kind === "letter"){
          playerState[em].letter = val;
        } else {
          playerState[em].number = val;
        }
      }

      updateEquationsStatus();
      renderSolutionBox();
      checkWin();
    }

    // Sync an emoji everywhere once it's solved:
    // - fill and disable all phrase letter inputs for that emoji
    // - fill and disable all number inputs for that emoji in equations
    // - update solution box
    function syncSolvedEmojiEverywhere(em){
      const correctLetter = currentPuzzle.mapping[em].letter;
      const correctNumber = String(currentPuzzle.mapping[em].number);
      playerState[em].solved  = true;
      playerState[em].letter  = correctLetter;
      playerState[em].number  = correctNumber;

      // phrase inputs
      const phraseInputs = phraseArea.querySelectorAll(`.char-input[data-emoji="${em}"]`);
      phraseInputs.forEach(inp=>{
        inp.value = correctLetter;
        inp.disabled = true;
      });

      // equation inputs
      const eqInputs = equationsArea.querySelectorAll(`.num-input[data-emoji="${em}"]`);
      eqInputs.forEach(inp=>{
        inp.value = correctNumber;
        inp.disabled = true;
      });

      renderSolutionBox();
    }

    // Check equations to set ‚úÖ / ‚ùå
    function updateEquationsStatus(){
      currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
        let allKnown = true;
        let total = 0;

        eqObj.left.forEach(token=>{
          if(token === "+") return;
          if(playerState[token].solved){
            total += currentPuzzle.mapping[token].number;
          } else {
            allKnown = false;
          }
        });

        const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
        if(!resDiv) return;
        if(allKnown && total === eqObj.target){
          resDiv.textContent = "‚úÖ";
          resDiv.classList.remove("status-bad");
          resDiv.classList.add("status-ok");
        } else {
          resDiv.textContent = "‚ùå";
          resDiv.classList.remove("status-ok");
          resDiv.classList.add("status-bad");
        }
      });
    }

    // Build the solved phrase so far:
    // For win check, we ONLY accept correct solved emojis.
    // Unsolved positions count as "_".
    function getCurrentSolvedPhrase(){
      const wordsSolved = currentPuzzle.phraseWords.map(wordArr => {
        return wordArr.map(em => {
          if(playerState[em].solved){
            return currentPuzzle.mapping[em].letter;
          } else {
            return "_";
          }
        }).join("");
      });
      return wordsSolved.join(" ");
    }

    function launchConfetti() {
  if (hasCelebrated) return;
  hasCelebrated = true;

  const layer = document.getElementById("confettiLayer");
  if (!layer) return;

  // MUCH larger pool, including puzzle-ish symbols and hype emojis
  const confettiEmojis = [
    "üéâ","üéä","‚ú®","üí•","üí´","üåü","üî•","ü§©","üòé","ü¶Ñ",
    "ü¶ä","üê∏","ü™ê","üé≤","üöÄ","üåµ","üîÆ","üßä","üêô","üçÑ","ü¶¥","üê¢","ü™º","üêç"
  ];

  // Spawn more particles for bigger celebration
  const howMany = 60;

  for (let i = 0; i < howMany; i++) {
    const piece = document.createElement("div");
    piece.className = "confetti-emoji";
    piece.textContent = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];

    // Start near bottom center
    // We'll express start position in viewport units so it scales
    const startXvw = 50;                 // middle of screen
    const startYvh = 90 + Math.random()*4; // around bottom (90-94vh)

    // Pick a launch angle and distance
    // angle between, say, -75deg (up-left) to -105deg (up-right) gives narrow cone,
    // but you asked "all corners", so let's go wide: -40deg (up-right-ish) to -140deg (up-left-ish)
    const angleDeg = -40 - Math.random()*100; // -40 to -140
    const angleRad = angleDeg * Math.PI / 180;

    // speed magnitude (how far it travels)
    const distanceVh = 40 + Math.random()*30; // 40-70vh "height" of travel
    // convert polar to x/y deltas in viewport units
    const dxVw = Math.cos(angleRad) * (distanceVh * 0.6); // scale to vw-ish
    const dyVh = Math.sin(angleRad) * distanceVh; // negative (goes up)

    // end positions
    const endXvw = startXvw + dxVw;
    const endYvh = startYvh + dyVh; // should be much smaller vh (toward top)

    // animation timing
    const duration = 800 + Math.random()*700; // 0.8s - 1.5s
    const delay    = Math.random()*100;       // up to 0.1s

    // feed the keyframe custom props
    piece.style.setProperty('--x-start', startXvw + 'vw');
    piece.style.setProperty('--y-start', startYvh + 'vh');
    piece.style.setProperty('--x-end',   endXvw  + 'vw');
    piece.style.setProperty('--y-end',   endYvh  + 'vh');

    // hook into animation
    piece.style.left = startXvw + "vw";
    piece.style.top  = startYvh + "vh";
    piece.style.animationName = "burst-fade";
    piece.style.animationDuration = duration + "ms";
    piece.style.animationDelay    = delay + "ms";

    layer.appendChild(piece);

    // cleanup after it's done
    setTimeout(() => {
      piece.remove();
    }, duration + delay + 200);
  }
}


    // Check win:
    // - phrase must be fully revealed AND match puzzle.phrase
    // - all equations must show ‚úÖ
    function checkWin(){
  const finalPhrase = getCurrentSolvedPhrase();
  const phraseDone = (finalPhrase === currentPuzzle.phrase);

  let allEqCorrect = true;
  currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
    const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
    if(!resDiv || !resDiv.classList.contains("status-ok")){
      allEqCorrect = false;
    }
  });

  if (phraseDone && allEqCorrect) {
  if (winBox) {
    winBox.style.display = "block";
  }
  launchConfetti();
} else {
  if (winBox) {
    winBox.style.display = "none";
  }
}

      /*Load Puzzle */
function loadPuzzle(index){
  if (index < 0) index = 0;
  if (index > PUZZLES.length - 1) index = PUZZLES.length - 1;
  currentIndex = index;
  currentPuzzle = PUZZLES[currentIndex];
  hasCelebrated = false;

  // reset state
  for (const key of Object.keys(playerState)) {
    delete playerState[key];
  }
  currentPuzzle.uniqueEmojis.forEach(em=>{
    playerState[em] = { letter:"", number:"", solved:false };
  });

  // re-render
  renderPhrase();
  renderEquations();
  renderSolutionBox();

  // update label
  if (puzzleLabel) {
    puzzleLabel.textContent = `Puzzle ${currentIndex+1} / ${PUZZLES.length}`;
  }
}

    // Init
    function init(){
  loadPuzzle(0); // start on the first puzzle
}
    init();

      if (prevBtn) {
  prevBtn.addEventListener("click", ()=>{
    loadPuzzle(currentIndex - 1);
  });
}
if (nextBtn) {
  nextBtn.addEventListener("click", ()=>{
    loadPuzzle(currentIndex + 1);
  });
}


  })();
  </script>
</body>
</html>
