<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emoji Cipher™ – Puzzle</title>
  <meta name="description" content="Emoji Cipher™ is an original logic puzzle by Salimah Ismail. Decode the emojis to reveal the hidden phrase and balance the equations.">
  <meta name="author" content="Salimah Ismail">
  <meta name="copyright" content="© 2025 Salimah Ismail. Licensed under CC BY-NC-ND 4.0 International.">
  <meta name="license" content="https://creativecommons.org/licenses/by-nc-nd/4.0/">
  <style>
    body {
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;
      margin: 2rem auto;
      max-width: 680px;
      line-height: 1.5;
      color: #222;
      background: #fdfdfd;
    }
    h1, h2 { text-align: center; }

    .note-box {
      background: #fff8db;
      border: 1px solid #e6d78a;
      border-radius: .5rem;
      padding: .75rem;
      margin-bottom: 1rem;
      font-size: .9rem;
    }

    .section-title{
      font-size:1rem;
      font-weight:600;
      margin:1.5rem 0 .5rem;
      text-transform:uppercase;
      letter-spacing:.03em;
      color:#444;
    }

    /* Phrase layout */
    .phrase-wrapper {
      background:#fff;
      border:1px solid #ddd;
      border-radius:.5rem;
      padding:1rem;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      display:flex;
      flex-wrap:wrap;
      row-gap:1rem;
      column-gap:1rem;
      font-size:1.1rem;
    }

    .word-block {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
    }

    .word-top-row,
    .word-bottom-row {
      display:flex;
      align-items:flex-start;
      gap:.6rem;
      flex-wrap:nowrap;
    }

    .char-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .char-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1.1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .char-input::placeholder {
      color:#999;
      font-weight:400;
    }
    .char-input:focus{
      outline:none;
      border-color:#000;
    }
    .char-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .char-emoji {
      font-size:1.4rem;
      line-height:1.2;
      margin-top:.25rem;
    }

    .word-separator {
      font-weight:600;
      font-size:1rem;
      line-height:1;
      color:#666;
      margin-left:.5rem;
    }

    /* Equations block */
    .equations-wrapper{
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:.75rem 1rem;
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      font-size:.9rem;
    }

    .equation-row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:.75rem 1rem;
      padding:.75rem 0;
      border-bottom:1px solid #eee;
    }
    .equation-row:last-child{border-bottom:none;}

    .eq-left {
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      align-items:flex-end;
    }

    .eq-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      min-width:2.4rem;
    }

    .num-input {
      width:2.4rem;
      height:2.4rem;
      font-size:1rem;
      text-align:center;
      font-weight:600;
      border:1.5px solid #bbb;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / 0.05);
      font-family:inherit;
    }
    .num-input::placeholder{
      color:#999;
      font-weight:400;
    }
    .num-input:focus{
      outline:none;
      border-color:#000;
    }
    .num-input[disabled]{
      background:#e6ffe6;
      border-color:#108a00;
      color:#0a4f00;
      font-weight:600;
    }

    .eq-op {
      font-size:1.1rem;
      font-weight:600;
      line-height:1;
      align-self:center;
    }

    .eq-target {
      font-weight:600;
    }

    .eq-result {
      font-weight:600;
      min-width:2rem;
      text-align:center;
    }
    .status-ok{color:#108a00;}
    .status-bad{color:#b00020;}

    /* Solution key */
    .solution-box {
      border:1px solid #ddd;
      border-radius:.5rem;
      background:#fff;
      box-shadow:0 1px 2px rgb(0 0 0 / .05);
      padding:1rem;
      font-size:.95rem;
      line-height:1.4;
      color:#222;
      white-space:pre-line;
    }
    .solution-line-solved {
      background:#e6ffe6;
      border-left:3px solid #108a00;
      padding:.25rem .5rem;
      border-radius:.25rem;
      margin-bottom:.5rem;
      font-weight:600;
      color:#0a4f00;
      box-shadow:0 1px 2px rgb(0 0 0 / .06) inset;
    }
    .solution-hint {
      font-size:.8rem;
      color:#666;
      margin-bottom:.5rem;
    }

    .win-box{
      margin-top:1rem;
      border-radius:.75rem;
      padding:1rem;
      font-weight:600;
      text-align:center;
      font-size:1rem;
      display:none;
      background:#e6ffe6;
      border:2px solid #108a00;
      color:#0a4f00;
      box-shadow:0 4px 10px rgb(0 0 0 / .08);
    }

    footer{
      margin-top:2rem;
      font-size:.8rem;
      text-align:center;
      color:#666;
    }
    footer a{
      color:#555;
      text-decoration:none;
    }
  </style>
</head>
<body>
  <h1>Emoji Cipher™</h1>
  <h2>Puzzle</h2>

  <div class="note-box">
    Each emoji is secretly one LETTER and one NUMBER.<br>
    Type your guess in the box above the emoji.<br>
    If you crack it anywhere, we'll fill it in everywhere.
  </div>

  <div class="section-title">Your Decoded Phrase</div>
  <div class="phrase-wrapper" id="phraseArea"></div>

  <div class="section-title">Check the Math</div>
  <div class="equations-wrapper" id="equationsArea"></div>

  <div class="section-title">Solution Key (auto-fills as you solve)</div>
  <div class="solution-box" id="solutionBox">
    <div class="solution-hint">Solve any letter or number to unlock its pair:</div>
    <div id="solutionLines"></div>
  </div>

  <div class="win-box" id="winBox">
    ✅ You solved it!
  </div>

  <footer>
    Emoji Cipher™ © 2025 Salimah Ismail.<br>
    Licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0 International</a>.
  </footer>

  <script>
  (function(){

    // Single test puzzle: COOL GAME BRO
    const currentPuzzle = {
      phrase: "COOL GAME BRO",
      phraseWords: [
        ["🦊","🪐","🪐","🐸"],        // COOL
        ["🚀","🌵","🎲","🔮"],        // GAME
        ["🧊","🌵","🪐"]             // BRO
      ],
      mapping: {
        "🦊": { letter:"C", number:3 },
        "🪐": { letter:"O", number:8 },
        "🐸": { letter:"L", number:4 },
        "🚀": { letter:"G", number:7 },
        "🌵": { letter:"A", number:1 },
        "🎲": { letter:"M", number:6 },
        "🔮": { letter:"E", number:2 },
        "🧊": { letter:"B", number:5 }
      },
      uniqueEmojis: ["🦊","🪐","🐸","🚀","🌵","🎲","🔮","🧊"],
      equations: [
        { left:["🦊","+","🪐"], target:11 },              //3+8
        { left:["🪐","+","🐸"], target:12 },              //8+4
        { left:["🚀","+","🌵","+","🎲"], target:14 },     //7+1+6
        { left:["🎲","+","🔮"], target:8 },              //6+2
        { left:["🧊","+","🌵"], target:6 }               //5+1
      ]
    };

    // Track solve state
    const playerState = {};
    currentPuzzle.uniqueEmojis.forEach(em=>{
      playerState[em] = { letter:"", number:"", solved:false };
    });

    const phraseArea    = document.getElementById("phraseArea");
    const equationsArea = document.getElementById("equationsArea");
    const solutionBox   = document.getElementById("solutionBox");
    const solutionLines = document.getElementById("solutionLines");
    const winBox        = document.getElementById("winBox");

    // RENDER PHRASE
    // Each word renders:
    //  top row: inputs per emoji
    //  bottom row: emojis in same order
    //  separator "/" after the word (except last word)
    function renderPhrase(){
      phraseArea.innerHTML = "";

      currentPuzzle.phraseWords.forEach((wordArr, wordIdx)=>{
        const wordBlock = document.createElement("div");
        wordBlock.className = "word-block";

        const topRow = document.createElement("div");
        topRow.className = "word-top-row";

        const bottomRow = document.createElement("div");
        bottomRow.className = "word-bottom-row";

        wordArr.forEach((em, charIdx)=>{
          const stack = document.createElement("div");
          stack.className = "char-stack";
          stack.dataset.emoji = em;
          stack.dataset.wordIndex = wordIdx;
          stack.dataset.charIndex = charIdx;

          const inp = document.createElement("input");
          inp.className = "char-input";
          inp.maxLength = 1;
          inp.placeholder = "_";
          inp.dataset.emoji = em;
          inp.dataset.kind = "letter";
          inp.addEventListener("input", handleGuessInput);

          const emDiv = document.createElement("div");
          emDiv.className = "char-emoji";
          emDiv.textContent = em;

          stack.appendChild(inp);
          stack.appendChild(emDiv);
          topRow.appendChild(stack);
        });

        // bottom row is just the emojis again in a flat row
        wordArr.forEach(em=>{
          const emSpan = document.createElement("div");
          emSpan.className = "char-emoji";
          emSpan.textContent = em;
          bottomRow.appendChild(emSpan);
        });

        wordBlock.appendChild(topRow);
        wordBlock.appendChild(bottomRow);

        // Add the wordBlock
        phraseArea.appendChild(wordBlock);

        // After each word except last, show "/"
        if (wordIdx < currentPuzzle.phraseWords.length - 1){
          const slash = document.createElement("div");
          slash.className = "word-separator";
          slash.textContent = "/";
          phraseArea.appendChild(slash);
        }
      });
    }

    // RENDER EQUATIONS
    // Each operand is num-input stacked over emoji, with placeholders
    function renderEquations(){
      equationsArea.innerHTML = "";

      currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
        const row = document.createElement("div");
        row.className = "equation-row";

        const leftWrap = document.createElement("div");
        leftWrap.className = "eq-left";

        eqObj.left.forEach(token=>{
          if(token === "+"){
            const plus = document.createElement("div");
            plus.className = "eq-op";
            plus.textContent = "+";
            leftWrap.appendChild(plus);
          } else {
            const stack = document.createElement("div");
            stack.className = "eq-stack";
            stack.dataset.emoji = token;
            stack.dataset.eqIndex = eqIndex;

            const numInp = document.createElement("input");
            numInp.className = "num-input";
            numInp.maxLength = 1;
            numInp.placeholder = "_";
            numInp.dataset.emoji = token;
            numInp.dataset.kind = "number";
            numInp.addEventListener("input", handleGuessInput);

            const emDiv = document.createElement("div");
            emDiv.className = "char-emoji";
            emDiv.textContent = token;

            stack.appendChild(numInp);
            stack.appendChild(emDiv);
            leftWrap.appendChild(stack);
          }
        });

        const eqTarget = document.createElement("div");
        eqTarget.className = "eq-target";
        eqTarget.textContent = "= " + eqObj.target;

        const eqRes = document.createElement("div");
        eqRes.className = "eq-result status-bad";
        eqRes.dataset.eqIndex = eqIndex;
        eqRes.textContent = "❌";

        row.appendChild(leftWrap);
        row.appendChild(eqTarget);
        row.appendChild(eqRes);
        equationsArea.appendChild(row);
      });

      updateEquationsStatus(); // initial
    }

    // RENDER SOLUTION KEY
    // We'll re-render the list every time something new is solved.
    function renderSolutionBox(){
      solutionLines.innerHTML = "";
      currentPuzzle.uniqueEmojis.forEach(em=>{
        const st = playerState[em];
        if(st.solved){
          const line = document.createElement("div");
          line.className = "solution-line-solved";
          line.textContent = `${em} = ${st.letter} = ${st.number}`;
          solutionLines.appendChild(line);
        }
      });
    }

    // HANDLE INPUTS (letters in phrase, numbers in math)
    function handleGuessInput(e){
      const em   = e.target.dataset.emoji;
      const kind = e.target.dataset.kind; // "letter" or "number"

      // if solved already, just force sync and stop
      if(playerState[em].solved){
        syncSolvedEmojiEverywhere(em);
        updateEquationsStatus();
        checkWin();
        return;
      }

      let val = e.target.value;

      if(kind === "letter"){
        // normalize to one A-Z uppercase
        val = val.toUpperCase().replace(/[^A-Z]/g,"").slice(0,1);
        e.target.value = val; // we do NOT put "_" anymore
      } else {
        // kind === "number"
        if(val !== ""){
          let n = parseInt(val,10);
          if(isNaN(n)) n = "";
          if(n < 0) n = 0;
          if(n > 9) n = 9;
          e.target.value = n === "" ? "" : String(n);
          val = e.target.value;
        }
      }

      const correctLetter = currentPuzzle.mapping[em].letter;
      const correctNumber = String(currentPuzzle.mapping[em].number);

      const solvedByLetter = (kind==="letter" && val === correctLetter);
      const solvedByNumber = (kind==="number" && val === correctNumber);

      if(solvedByLetter || solvedByNumber){
        // Mark global solved
        playerState[em].solved  = true;
        playerState[em].letter  = correctLetter;
        playerState[em].number  = correctNumber;

        syncSolvedEmojiEverywhere(em);
      } else {
        // Partial guess; not solved yet
        if(kind === "letter"){
          playerState[em].letter = val;
        } else {
          playerState[em].number = val;
        }
      }

      updateEquationsStatus();
      renderSolutionBox();
      checkWin();
    }

    // syncSolvedEmojiEverywhere:
    // - fills and disables all char-inputs for that emoji with correct letter
    // - fills and disables all num-inputs for that emoji with correct number
    // - updates the solution box
    function syncSolvedEmojiEverywhere(em){
      const correctLetter = currentPuzzle.mapping[em].letter;
      const correctNumber = String(currentPuzzle.mapping[em].number);
      playerState[em].solved  = true;
      playerState[em].letter  = correctLetter;
      playerState[em].number  = correctNumber;

      // phrase inputs
      const phraseInputs = phraseArea.querySelectorAll(`.char-input[data-emoji="${em}"]`);
      phraseInputs.forEach(inp=>{
        inp.value = correctLetter;
        inp.disabled = true;
      });

      // equation inputs
      const eqInputs = equationsArea.querySelectorAll(`.num-input[data-emoji="${em}"]`);
      eqInputs.forEach(inp=>{
        inp.value = correctNumber;
        inp.disabled = true;
      });

      // refresh the solution box
      renderSolutionBox();
    }

    // Equation checking
    function updateEquationsStatus(){
      currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
        let allKnown = true;
        let total = 0;

        eqObj.left.forEach(token=>{
          if(token === "+") return;
          if(playerState[token].solved){
            total += currentPuzzle.mapping[token].number;
          } else {
            allKnown = false;
          }
        });

        const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
        if(!resDiv) return;
        if(allKnown && total === eqObj.target){
          resDiv.textContent = "✅";
          resDiv.classList.remove("status-bad");
          resDiv.classList.add("status-ok");
        } else {
          resDiv.textContent = "❌";
          resDiv.classList.remove("status-ok");
          resDiv.classList.add("status-bad");
        }
      });
    }

    // Build the user's solved phrase at any moment
    // We ONLY use solved emojis for final answer. Unsolved = "_".
    function getCurrentSolvedPhrase(){
      const wordsSolved = currentPuzzle.phraseWords.map(wordArr => {
        return wordArr.map(em => {
          if(playerState[em].solved){
            return currentPuzzle.mapping[em].letter;
          } else {
            return "_";
          }
        }).join("");
      });
      return wordsSolved.join(" ");
    }

    // Check win
    function checkWin(){
      const finalPhrase = getCurrentSolvedPhrase();
      const phraseDone = (finalPhrase === currentPuzzle.phrase);

      let allEqCorrect = true;
      currentPuzzle.equations.forEach((eqObj, eqIndex)=>{
        const resDiv = equationsArea.querySelector(`.eq-result[data-eq-index="${eqIndex}"]`);
        if(!resDiv || !resDiv.classList.contains("status-ok")){
          allEqCorrect = false;
        }
      });

      if(phraseDone && allEqCorrect){
        winBox.style.display = "block";
      } else {
        winBox.style.display = "none";
      }
    }

    // Initial render
    function init(){
      renderPhrase();
      renderEquations();
      renderSolutionBox(); // initially empty
    }

    init();

  })();
  </script>
</body>
</html>
